# 20.1 D3 / ECharts / AntV ä½“ç³» ğŸ¯ğŸ“Š

ç›®æ ‡ï¼šç”¨ä¸€ç« æŠŠä¸‰å¤§å¯è§†åŒ–é˜µè¥çš„**é€‰å‹ã€å¿ƒæ™ºæ¨¡å‹ã€é›†æˆå¥—è·¯ã€æ€§èƒ½ä¸å¯ç»´æŠ¤**è¯´æ¸…æ¥šï¼Œç»™åˆ°èƒ½ç›´æ¥æŠ„çš„ä»£ç ä¸æµç¨‹ã€‚å£å·ï¼š**â€œå›¾å½¢è¯­æ³•å®šè§„åˆ™ï¼Œå£°æ˜é…ç½®å‡ºæˆå›¾ï¼Œå·¥ç¨‹èƒ½åŠ›ä¿äº¤ä»˜ã€‚â€**

---

## 0) TL;DRï¼ˆå…ˆæŠ„ä¸‰æ¡ï¼‰âš¡
1. **äº§å“å¿«é€Ÿä¸Šçº¿ / å¤§è€Œå…¨ç»„ä»¶** â†’ é€‰ **ECharts**ï¼›  
   **é«˜è‡ªç”±åº¦ / å®šåˆ¶äº¤äº’ / ç ”ç©¶å‹** â†’ é€‰ **D3**ï¼›  
   **è¯­æ³•åŒ– + ç”Ÿæ€é½å…¨ + å•†ä¸šçº§å·¥ç¨‹åŒ–** â†’ é€‰ **AntVï¼ˆG2/Plot/G6/L7/S2ï¼‰**ã€‚
2. React/Vue é¡¹ç›®ä¼˜å…ˆç”¨**å®˜æ–¹/ç¤¾åŒºå°è£…**ï¼ˆ`@ant-design/plots`ã€`echarts-for-react`ã€`vue-echarts`ï¼‰ï¼Œ**çŠ¶æ€åªè¿›ä¸å‡º**ï¼ˆæ•°æ®â†’å›¾è¡¨ï¼‰ï¼Œäº¤äº’äº‹ä»¶å†å›æµåˆ°åº”ç”¨å±‚ã€‚
3. æ€§èƒ½å®ˆåˆ™ï¼š**SVG < Canvas < WebGL**ï¼›>10k ç‚¹ç”¨ Canvas/ä¸‹é‡‡æ ·ï¼Œ>100k ç‚¹ä¸Š WebGL/ç“¦ç‰‡/æŠ½ç¨€ï¼›é•¿åŠ¨ç”»è¿› **OffscreenCanvas + Worker**ã€‚

---

## 1) ä¸‰å®¶å¿«é€Ÿç”»åƒ ğŸ§­
| ç»´åº¦ | D3 | ECharts | AntV |
|---|---|---|---|
| å¿ƒæ™ºæ¨¡å‹ | **åº•å±‚å·¥å…·é›†**ï¼ˆæ•°æ®â†’DOM/Canvasï¼Œè¡Œä¸ºè‡ªå·±æ‹¼ï¼‰ | **é…ç½®é©±åŠ¨**ï¼ˆä¸€ä¸ª `option` å‡ºå›¾ï¼‰ | **å›¾å½¢è¯­æ³• / è¯­ä¹‰å±‚**ï¼ˆG2/Plotï¼‰ï¼Œå†å‘å›¾/åœ°ç†/è¡¨æ‰©å±• |
| å‡ºå›¾æ•ˆç‡ | ä¸­ï¼ˆè‡ªç”±åº¦é«˜ï¼Œæˆæœ¬ä¹Ÿé«˜ï¼‰ | é«˜ï¼ˆå¼€ç®±å³ç”¨ 80% åœºæ™¯ï¼‰ | ä¸­é«˜ï¼ˆPlot/G2 å¿«ï¼Œæ·±å®šåˆ¶ä¹Ÿèƒ½æ‰“ï¼‰ |
| è‡ªå®šä¹‰èƒ½åŠ› | æé«˜ï¼ˆç¼–è¯‘å™¨çº§åˆ«è‡ªç”±ï¼‰ | ä¸­ï¼ˆå¯å†™è‡ªå®šä¹‰ç³»åˆ—/æ’ä»¶ï¼‰ | é«˜ï¼ˆè‡ªå®šä¹‰æ ‡è®°/è§†å›¾/ä¸»é¢˜ï¼‰ |
| æ¸²æŸ“ | SVG/Canvas | Canvas/éƒ¨åˆ†SVG/WebGL(æ‰©å±•) | Canvas/SVG/WebGL(å­åº“) |
| ç”Ÿæ€ | d3-* æ¨¡å—æµ·ï¼Œè‡ªç”±æ‹¼è£… | åœ°å›¾ã€GLã€æ•°æ®é›†ã€å¯Œäº¤äº’ç»„ä»¶å…¨ | G2(ç»Ÿè®¡å›¾) / Plot(è¯­æ³•ç³–) / G6(å…³ç³»å›¾) / L7(åœ°å›¾) / S2(é€è§†è¡¨) |
| å­¦ä¹ æ›²çº¿ | é™¡å³­ï¼ˆä½†ä¸€åŠ³æ°¸é€¸ï¼‰ | å¹³ç¼“ | é€‚ä¸­ |

---

## 2) é€‰å‹æ¸…å•ï¼ˆåœºæ™¯â†’æ–¹æ¡ˆï¼‰ğŸ§ª
- **ä»ªè¡¨ç›˜ / ç›‘æ§ / BI**ï¼šECharts / AntV Plotï¼ˆä¸Šæ‰‹å¿«ã€ä¸»é¢˜ç»Ÿä¸€ã€è”åŠ¨æ–¹ä¾¿ï¼‰  
- **è®ºæ–‡å¤ç° / å¯è§£é‡Šå¯è§†åŒ– / åˆ›æ„å™äº‹**ï¼šD3ï¼ˆè‡ªå®šä¹‰æ ‡è®°ã€åˆ»åº¦ã€è¿‡æ¸¡ï¼‰  
- **åœ°å›¾/ç©ºé—´å¯è§†**ï¼šAntV L7 / ECharts GLï¼ˆç“¦ç‰‡ã€çƒ­åŠ›ã€çŸ¢é‡ï¼‰  
- **å…³ç³»ç½‘ç»œ**ï¼šAntV G6ï¼ˆå¸ƒå±€ä¸°å¯Œï¼‰  
- **æ˜ç»†+æŒ‡æ ‡è”åŠ¨**ï¼šAntV S2ï¼ˆè½»é‡é€è§†è¡¨ï¼‰  
- **è¶…å¤§ç‚¹çº¿é¢**ï¼ˆ>100k ç‚¹ï¼‰ï¼šEChartsï¼ˆ`large: true`ï¼‰/ AntV + GPGPU / WebGL ä¸“é¡¹

---

## 3) ç»Ÿä¸€å¿ƒæ™ºæ¨¡å‹ï¼ˆä½ åœ¨â€œå‘Šè¯‰â€ç³»ç»Ÿä»€ä¹ˆï¼‰ğŸ§ 
- **D3ï¼ˆImperativeï¼‰**ï¼šæˆ‘æ¥**æ€ä¹ˆç”»**ï¼ˆå°ºåº¦/è½´/å¸ƒå±€/è¿‡æ¸¡ï¼‰ï¼›åƒå†™æ¸²æŸ“å¼•æ“ã€‚  
- **EChartsï¼ˆDeclarativeï¼‰**ï¼šæˆ‘æ¥**ç”»ä»€ä¹ˆ**ï¼ˆç±»å‹+æ•°æ®+æ ·å¼+äº¤äº’ï¼‰ï¼Œå¼•æ“è‡ªå·±æ’å¸ƒã€‚  
- **AntVï¼ˆGrammar of Graphicsï¼‰**ï¼šæˆ‘æ¥**è¡¨è¾¾å…³ç³»**ï¼ˆæ•°æ®â†’ç¼–ç ï¼š`x/y/color/shape/size`ï¼‰ï¼Œå¼•æ“æ®â€œè¯­æ³•â€å‡ºå›¾ã€‚

> ç»“è®ºï¼š**å…ˆç”¨å£°æ˜å¼æ‹¿ç»“æœ**ï¼Œå†ç”¨ D3 åšâ€œè¾¹ç•Œçªç ´â€ã€‚

---

## 4) æé€Ÿä¸Šæ‰‹ä¸‰è¿å‘ï¼ˆå¯ç›´æ¥æŠ„ï¼‰ğŸš€

### 4.1 D3ï¼šæœ€å°æŸ±çŠ¶å›¾ + è¿‡æ¸¡
```js
import * as d3 from "d3";

const data = [12, 36, 28, 50, 18];
const w = 400, h = 160, m = {l:30, r:10, t:10, b:24};

const x = d3.scaleBand().domain(d3.range(data.length)).range([m.l, w-m.r]).padding(0.2);
const y = d3.scaleLinear().domain([0, d3.max(data)]).range([h-m.b, m.t]);

const svg = d3.select("#app").append("svg").attr("width", w).attr("height", h);
svg.append("g").attr("transform", `translate(0,${h-m.b})`).call(d3.axisBottom(x).tickFormat(i=>`#${i+1}`));
svg.append("g").attr("transform", `translate(${m.l},0)`).call(d3.axisLeft(y).ticks(5));

svg.selectAll("rect").data(data).join("rect")
  .attr("x", (_,i)=>x(i)).attr("width", x.bandwidth()).attr("y", y(0)).attr("height", 0)
  .transition().duration(600).attr("y", d=>y(d)).attr("height", d=>y(0)-y(d));
```

### 4.2 EChartsï¼šé…ç½®å‡ºå›¾ï¼ˆå¸¦ç¼©æ”¾+æç¤ºï¼‰
```js
import * as echarts from "echarts";

const chart = echarts.init(document.getElementById("app"));
chart.setOption({
  tooltip: { trigger: "axis" },
  dataZoom: [{ type: "inside" }, { type: "slider" }],
  xAxis: { type: "category", data: ["Mon","Tue","Wed","Thu","Fri"] },
  yAxis: { type: "value" },
  series: [{ type: "bar", data: [120, 200, 150, 80, 70], emphasis: { focus: "series" }, animationDuration: 500 }]
});
window.addEventListener("resize", () => chart.resize());
```

### 4.3 AntV Plotï¼ˆG2 è¯­æ³•ç³–ï¼‰ï¼šä¸€è¡Œä¸€ä¸ªå›¾
```js
import { Column } from "@ant-design/plots";

new Column("app", {
  data: [
    { day: "Mon", value: 120 }, { day: "Tue", value: 200 },
    { day: "Wed", value: 150 }, { day: "Thu", value: 80 }, { day: "Fri", value: 70 },
  ],
  xField: "day",
  yField: "value",
  interactions: [{ type: "element-highlight" }],
  animation: { appear: { animation: "scale-in-y", duration: 400 } },
  theme: "classic"
});
```

---

## 5) ä¸ React / Vue / Svelte é›†æˆ ğŸ”Œ
- **ä¼˜å…ˆå°è£…**ï¼š  
  - Reactï¼š`echarts-for-react`ã€`@ant-design/plots`ã€`@antv/g2-react`  
  - Vueï¼š`vue-echarts`ã€`@antv/g2plot-vue`  
- **å•å‘æ•°æ®æµ**ï¼šåº”ç”¨çŠ¶æ€ â†’ å›¾è¡¨é…ç½®/æ•°æ®ï¼Œäº¤äº’äº‹ä»¶ï¼ˆ`onEvents`/`onPlotClick`ï¼‰å†å›æµã€‚  
- **é¿å…é‡å¤ init**ï¼šåœ¨ `useEffect`/`onMounted` åª `init` ä¸€æ¬¡ï¼Œåç»­ç”¨ `setOption`/`update()`ã€‚  
- **å°ºå¯¸è‡ªé€‚åº”**ï¼šå®¹å™¨å˜åŒ–ç›‘å¬ï¼ˆ`ResizeObserver`ï¼‰â†’ `chart.resize()`ï¼›SSR/åŒæ„æ—¶å»¶è¿Ÿåˆ° `mounted` æ‰§è¡Œã€‚

---

## 6) æ€§èƒ½å·¥ç¨‹ï¼ˆä» 1k åˆ° 1M ç‚¹ï¼‰ğŸï¸
- **æ¸²æŸ“é€‰æ‹©**ï¼š  
  - <3k å…ƒç´ ï¼šSVGï¼ˆå¼€å‘èˆ’æœï¼Œäº¤äº’æ˜“ï¼‰  
  - 3kâ€“100kï¼šCanvasï¼ˆECharts/AntV é»˜è®¤å·²ç»ä¼˜åŒ–ï¼‰  
  - >100kï¼šWebGL/ç“¦ç‰‡/æŠ½ç¨€/èšåˆï¼ˆECharts GL / AntV L7 / è‡ªç ”ï¼‰  
- **æ•°æ®ç˜¦èº«**ï¼šä¸‹é‡‡æ ·ï¼ˆLTTB/æœ€å¤§æœ€å°æ³•ï¼‰ã€æ—¶é—´çª—å£èšåˆï¼ˆminuteâ†’5minï¼‰ã€åˆ†æ¡¶ï¼ˆhistogramï¼‰ã€‚  
- **åŠ¨ç”»ç­–ç•¥**ï¼šè¿›å…¥åŠ¨ç”»ä¸€æ¬¡æ€§ï¼›äº¤äº’åŠ¨ç”»ä¸è¶…è¿‡ 300â€“500msï¼›**ç¦ç”¨å…¨é‡é‡ç»˜**ï¼ˆå¢é‡æ›´æ–°ï¼‰ã€‚  
- **ç¦»å±ä¸å¹¶è¡Œ**ï¼š`OffscreenCanvas + Worker` åšé‡è®¡ç®—ï¼ˆå¸ƒå±€/é‡‡æ ·ï¼‰ï¼›ä¸»çº¿ç¨‹åªâ€œå‘ˆç°â€ã€‚  
- **äº‹ä»¶é—¨é™**ï¼šå¯†é›†æ»šåŠ¨/æ‹–æ‹½èŠ‚æµï¼ˆ`requestAnimationFrame`ï¼‰ï¼Œå·¥å…·æç¤ºèµ°å‘½ä¸­æµ‹è¯•è€Œééå†ã€‚

---

## 7) äº¤äº’ä¸å›¾è”åŠ¨ï¼ˆDrilldown / Brush / Linkï¼‰ğŸª„
- **äº¤äº’åŸå­**ï¼š`hover / select / brush / zoom / pan / tooltip / contextmenu`  
- **è”åŠ¨åè®®**ï¼šç»Ÿä¸€äº‹ä»¶æ€»çº¿ï¼ˆ`eventBus.emit("filter:update", payload)`ï¼‰ï¼Œæ‰€æœ‰å›¾è®¢é˜…ï¼›**ä¸è¦ç›¸äº’ç›´æ¥è°ƒç”¨**ã€‚  
- **è·¨å›¾è¡¨é«˜äº®**ï¼šä½¿ç”¨å…±äº« `seriesId/itemId` æˆ–ç»Ÿä¸€é”®ï¼ˆå¦‚ `userId`ï¼‰ï¼Œä¸¤è¾¹äº’ç›¸ `highlight/dispatchAction`ã€‚  
- **é’»å–**ï¼šClick â†’ æ›´æ–°å…¨å±€ filter â†’ ä¸Šæ¸¸ API æ‹‰å­æ•°æ® â†’ å­è§†å›¾åˆ·æ–°ã€‚

---

## 8) ä¸»é¢˜ä¸è®¾è®¡ç³»ç»Ÿï¼ˆè§†è§‰ä¸€è‡´æ€§ï¼‰ğŸ¨
- **è‰²æ¿**ï¼šä¸»è‰²+è¯­ä¹‰è‰²ï¼ˆæ­£/è´Ÿ/ä¸­æ€§ï¼‰ï¼Œé¡ºåºè‰²ä¸å®šæ€§è‰²åˆ†å¼€ç®¡ç†ã€‚  
- **æš—è‰²æ¨¡å¼**ï¼šèƒŒæ™¯ã€ç½‘æ ¼ã€æ–‡æœ¬å¯¹æ¯”åº¦ â‰¥ 4.5:1ï¼›ECharts `theme` / G2 `theme` ä¸€å¤„åˆ‡æ¢ã€‚  
- **çŠ¶æ€æ ·å¼**ï¼š`selected/hover/disabled/emphasis` ç»Ÿä¸€å®šä¹‰ã€‚  
- **å•ä½/æ ¼å¼**ï¼šåƒåˆ†ä½ã€æ—¶é—´/è´§å¸æœ¬åœ°åŒ–ï¼›åŒæ¯”/ç¯æ¯”ç®­å¤´ä¸è‰²å½©ç»Ÿä¸€ã€‚

---

## 9) a11y ä¸å›½é™…åŒ–ï¼ˆåˆ«å¿˜äº†ï¼‰ğŸ§ğŸŒ
- **å¯è¾¾æ€§**ï¼šç»™å›¾è¡¨å®¹å™¨ `role="img"` ä¸ `aria-label`ï¼›æä¾›**æ•°æ®è¡¨æ ¼è§†å›¾**ä¸**ä¸‹è½½ CSV**ã€‚  
- **é”®ç›˜æ“ä½œ**ï¼šå¯åˆ‡æ¢ç³»åˆ—/é«˜äº®æ•°æ®ç‚¹ï¼›å·¥å…·æç¤ºå¯ç”¨é”®ç›˜è§¦è¾¾ã€‚  
- **æ–‡æœ¬ä¸æ•°å­—**ï¼šæœ¬åœ°åŒ–æ—¥æœŸ/è´§å¸ï¼›æ•°å­—ç¼©å†™ï¼ˆK/M/Bï¼‰ä¸ä¸­æ–‡ä¸‡/äº¿åˆ‡æ¢ã€‚

---

## 10) åœ°å›¾/å…³ç³»/è¡¨æ ¼æ‰©å±•ï¼ˆAntV å®¶æ—ï¼‰ğŸ§©
- **L7ï¼ˆåœ°å›¾ï¼‰**ï¼šçƒ­åŠ›ã€æ ¼ç½‘ã€æµå‘ã€3D æŸ±ï¼›æ•°æ®é‡å¤§èµ° WebGLã€‚  
- **G6ï¼ˆå…³ç³»ï¼‰**ï¼šåŠ›å¯¼/å±‚æ¬¡/å¾„å‘å¸ƒå±€ï¼›è¾¹æ ·å¼ã€å›¢ç°‡ã€è·¯å¾„æŸ¥æ‰¾ã€‚  
- **S2ï¼ˆæ˜ç»†è¡¨/é€è§†ï¼‰**ï¼šç™¾ä¸‡çº§å•å…ƒæ ¼è™šæ‹ŸåŒ–ã€å†»ç»“è¡Œåˆ—ã€æ•°å€¼æ±‡æ€»ï¼›ä¸å›¾è¡¨è”åŠ¨åšâ€œå›¾è¡¨+è¡¨æ ¼â€ã€‚

---

## 11) æµ‹è¯•ä¸å¯ç»´æŠ¤æ€§ ğŸ§ª
- **å¿«ç…§**ï¼šé…å°æ•°æ®é›†æ¸²æŸ“é™æ€ SVG/Canvas å¿«ç…§ï¼ˆåƒç´ è¿‘ä¼¼æ¯”è¾ƒï¼‰ã€‚  
- **å¥‘çº¦**ï¼šå°è£…â€œç»˜å›¾å‡½æ•°â€æ¥æ”¶**æ ‡å‡†åŒ–æ•°æ®ç»“æ„**ï¼ˆä¾‹å¦‚ `{columns, rows}`ï¼‰ï¼Œä¾¿äºæ›¿æ¢åº•åº§ã€‚  
- **ç›‘æ§**ï¼šåŸ‹ç‚¹è®°å½•**æ¸²æŸ“è€—æ—¶/å¡é¡¿ç‡/äº¤äº’é”™è¯¯**ï¼›é¦–å±å›¾è¡¨å»¶åæŒ‚è½½ä»¥ä¿è¯ LCPã€‚  
- **Storybook**ï¼šæ¯ç§å›¾ä¸€ä¸ª storyï¼Œå«äº¤äº’æ€ï¼ˆselected/hover/empty/errorï¼‰ã€‚

---

## 12) åæ¨¡å¼ä¸çº å ğŸ§¨
| åæ¨¡å¼ | ç—‡çŠ¶ | çº å |
|---|---|---|
| ç›´æ¥æŠŠåŸå§‹ç™¾ä¸‡ç‚¹å…¨ç”» | é¡µé¢å¡æ­» | ä¸‹é‡‡æ ·/èšåˆ/è§†çª—+è™šæ‹ŸåŒ–/WebGL |
| åŒå‘æ‚è€¦ | ä¸€ä¸ªå›¾æ”¹åŠ¨å¦ä¸€ä¸ªå›¾ç‚¸ | äº‹ä»¶æ€»çº¿ + å•å‘æ•°æ®æµ |
| å¤šæ¬¡ init / æ³„æ¼ | åˆ‡é¡µå†…å­˜æš´æ¶¨ | åª `init` ä¸€æ¬¡ï¼Œè®°å¾— `dispose` |
| æ‰€æœ‰æ ·å¼å†™åœ¨ option | éš¾ç»Ÿä¸€ | ä¸»é¢˜é›†ä¸­é…ç½® + è¯­ä¹‰è‰² |
| å›¾è¡¨é€»è¾‘å†™åœ¨ç»„ä»¶é‡Œ | é‡å¤éš¾æµ‹ | æç‚¼â€œåˆ¶å›¾å™¨â€çº¯å‡½æ•°ï¼ˆè¾“å…¥â†’é…ç½®ï¼‰ |
| é«˜é¢‘åˆ·æ–° setOption å…¨é‡ | æŠ–åŠ¨å¡é¡¿ | å¢é‡æ›´æ–°/èŠ‚æµ/`lazyUpdate` |

---

## 13) éªŒæ”¶æ¸…å• âœ…
- [ ] é€‰å‹ä¾æ®ä¸â€œé€€è·¯â€ï¼ˆè¦ä¸è¦ D3 å…œåº•ï¼‰å·²å†™å…¥è®¾è®¡è¯´æ˜ã€‚  
- [ ] ä¸»é¢˜ä¸è‰²æ¿ç»Ÿä¸€ï¼Œæš—é»‘æ¨¡å¼å¯¹æ¯”åº¦åˆè§„ã€‚  
- [ ] æ•°æ®é‡è¯„ä¼°ä¸é™é‡‡æ ·ç­–ç•¥è½åœ°ï¼ˆ>10k Canvasï¼Œ>100k WebGL/æŠ½ç¨€ï¼‰ã€‚  
- [ ] äº‹ä»¶æ€»çº¿ä¸è”åŠ¨åè®®å®Œæˆï¼Œç»„ä»¶æ— ç¯ä¾èµ–ã€‚  
- [ ] æ¸²æŸ“/äº¤äº’æ€§èƒ½ç›‘æ§ä¸å‘Šè­¦ä¸Šçº¿ã€‚  
- [ ] a11yï¼šARIA æ–‡æ¡ˆ + è¡¨æ ¼å¤‡é€‰ + é”®ç›˜è·¯å¾„ã€‚  
- [ ] å•å…ƒ/å¯è§†å›å½’æµ‹è¯•é€šè¿‡ï¼›`dispose()` æ— æ³„æ¼ã€‚

---

## 14) ç»ƒä¹  ğŸ‹ï¸
1. ç”¨ **ECharts** åšæŠ˜çº¿+æŸ±çŠ¶åŒè½´ï¼Œæ”¯æŒç¼©æ”¾ã€åŒºåŸŸåˆ·é€‰ã€é«˜äº®è”åŠ¨ã€‚  
2. ç”¨ **D3** å®ç°è‡ªå®šä¹‰æ•£ç‚¹å›¾ï¼Œé™„å¸¦å››è±¡é™èƒŒæ™¯ä¸æ‹–æ‹½é€‰æ¡†ã€‚  
3. ç”¨ **AntV Plot** å¤ç°â€œæ¼æ–— + ç¯æ¯”æ ‡æ³¨â€ï¼Œå¹¶å°è£…æˆ `useChart` é’©å­ã€‚  
4. åŒä¸€æ•°æ®æºåœ¨ä¸‰å®¶å„å®ç°ä¸€æ¬¡ï¼Œå¯¹æ¯”ï¼šä»£ç è¡Œæ•°/é‡æ„éš¾åº¦/æ€§èƒ½ä¸äº¤äº’ã€‚

---

## 15) æ¨¡æ¿ç‰‡æ®µï¼ˆå·¥ç¨‹å¯å¤ç”¨ï¼‰ğŸ§°

### 15.1 React + ECharts å°è£…
```tsx
import React, { useEffect, useRef } from "react";
import * as echarts from "echarts";

export function EChart({ option, style }) {
  const ref = useRef(null);
  const inst = useRef(null);

  useEffect(() => {
    inst.current = echarts.init(ref.current);
    const ro = new ResizeObserver(() => inst.current?.resize());
    ro.observe(ref.current);
    return () => { ro.disconnect(); inst.current?.dispose(); };
  }, []);

  useEffect(() => { inst.current?.setOption(option, { notMerge: true, lazyUpdate: true }); }, [option]);
  return <div ref={ref} style={{ width: "100%", height: 300, ...style }} />;
}
```

### 15.2 æ•°æ®ä¸‹é‡‡æ ·ï¼ˆLTTB ç®€åŒ–ç‰ˆï¼‰
```js
export function lttb(points, threshold=2000) {
  if (points.length <= threshold) return points;
  const bucketSize = (points.length - 2) / (threshold - 2);
  const sampled = [points[0]];
  let a = 0;
  for (let i=0; i<threshold-2; i++) {
    const start = Math.floor((i+1)*bucketSize) + 1;
    const end = Math.floor((i+2)*bucketSize) + 1;
    const bucket = points.slice(start, end);
    const avgX = bucket.reduce((s,p)=>s+p.x,0)/bucket.length;
    const avgY = bucket.reduce((s,p)=>s+p.y,0)/bucket.length;
    let maxArea=-1, next=a+1;
    for (let j=start;j<end;j++){
      const area = Math.abs((points[a].x-avgX)*(points[j].y-points[a].y) - (points[a].x-points[j].x)*(avgY-points[a].y));
      if (area>maxArea){maxArea=area;next=j;}
    }
    sampled.push(points[next]); a = next;
  }
  sampled.push(points[points.length-1]);
  return sampled;
}
```

---

**å°ç»“**ï¼š**ECharts** è§£å†³â€œå¿«â€å’Œâ€œç¨³â€ï¼Œ**D3** è§£å†³â€œéš¾â€å’Œâ€œæ–°â€ï¼Œ**AntV** åœ¨â€œè¯­æ³•åŒ– + ä½“ç³»åŒ–â€ä¹‹é—´å–å¹³è¡¡ã€‚æŠŠ**é€‰å‹â†’è¯­æ³•â†’å·¥ç¨‹â†’æ€§èƒ½â†’è”åŠ¨â†’æµ‹è¯•**ä¸€æ¡é¾™æ‰“é€šï¼Œä½ çš„å¯è§†åŒ–å°±ä¸å†æ˜¯â€œç”»å›¾â€ï¼Œè€Œæ˜¯**äº§å“èƒ½åŠ›**ã€‚ğŸ› ï¸âœ¨
